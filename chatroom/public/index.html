<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatroom</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
    <!-- Login Screen -->
    <div id="loginContainer" class="flex justify-center items-center h-screen bg-gray-50">
        <div class="bg-white shadow-md rounded-lg p-8 max-w-sm w-full text-center">
            <h3 class="text-xl font-semibold mb-4">Login</h3>
            <input type="text" id="username" class="w-full p-3 mb-4 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="Enter your username">
            <input type="password" id="password" class="w-full p-3 mb-4 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="Enter your password">
            <button onclick="login()" class="w-full bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600">Login</button>
            <p id="loginStatus" class="text-red-500 mt-3"></p>
        </div>
    </div>

    <!-- Chat Screen -->
    <div id="chatContainer" class="hidden h-screen flex flex-row">
        <!-- Users Online -->
        <div class="w-1/3 bg-white shadow-md border-r overflow-y-auto">
            <h3 class="text-lg font-semibold bg-gray-200 p-4">Users Online:</h3>
            <ul id="userList" class="p-4 space-y-2 text-gray-700"></ul>
        </div>

        <!-- Chat Area -->
        <div class="w-2/3 flex flex-col bg-gray-50">
            <div class="flex flex-col h-full">
                <!-- Group Chat -->
                <div>
                    <h3 class="text-lg font-semibold bg-gray-200 p-4">Group Chat</h3>
                </div>
                <div id="groupChat" class="flex-grow overflow-y-auto bg-white shadow-inner border rounded-lg p-4 mb-4"></div>

                <div class="flex gap-2 items-center px-4">
                    <textarea id="groupMessage" class="flex-grow p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="Type a message..."></textarea>
                    <button onclick="sendGroupMessage()" class="bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600">Send</button>
                </div>
            </div>

            <!-- Private Chat -->
            <div class="mt-4">
                <h3 class="text-lg font-semibold bg-gray-200 p-4">Private Chat</h3>
                <div id="privateChatBox" class="overflow-y-auto bg-white shadow-inner border rounded-lg p-4 h-64"></div>
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io("http://192.168.29.13:3000");
        let loggedInUser = null;

        function login() {
            const username = document.getElementById("username").value;
            const password = document.getElementById("password").value;

            if (username && password) {
                socket.emit("login", { username, password });
            } else {
                document.getElementById("loginStatus").innerText = "Please enter both username and password.";
            }
        }

        socket.on("loginSuccess", (message) => {
            loggedInUser = document.getElementById("username").value;
            document.getElementById("loginContainer").classList.add("hidden");
            document.getElementById("chatContainer").classList.remove("hidden");
            alert(message);
        });

        socket.on("loginFailure", (message) => {
            document.getElementById("loginStatus").innerText = message;
        });

        socket.on("updateUserList", (users) => {
            const userList = document.getElementById("userList");
            userList.innerHTML = users
                .map((user) => {
                    if (user === loggedInUser) {
                        return `<li>${user} (You)</li>`;
                    } else {
                        return `<li class='flex justify-between items-center'>${user} <button onclick="requestPrivateChat('${user}')" class='text-blue-500 hover:underline'>Chat</button></li>`;
                    }
                })
                .join("");
        });

        function sendGroupMessage() {
            const message = document.getElementById("groupMessage").value;
            if (message.trim()) {
                socket.emit("sendGroupMessage", message);
                document.getElementById("groupMessage").value = "";
            }
        }

        socket.on("groupMessage", (data) => {
            const groupChat = document.getElementById("groupChat");
            groupChat.innerHTML += `<p><strong>${data.from}:</strong> ${data.message}</p>`;
            groupChat.scrollTop = groupChat.scrollHeight;
        });

        function requestPrivateChat(toUsername) {
            const message = prompt("Enter your private message:");
            if (message) {
                socket.emit("requestPrivateChat", { toUsername, message });
            }
        }

        socket.on("privateChatRequest", (data) => {
            const privateChatBox = document.getElementById("privateChatBox");
            privateChatBox.innerHTML += `<p><strong>${data.fromUsername}:</strong> ${data.message}</p>`;
            privateChatBox.scrollTop = privateChatBox.scrollHeight;
        });

        socket.on("privateChatError", (message) => {
            alert(message);
        });
    </script>
</body>
</html>
